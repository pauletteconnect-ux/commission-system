<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kami Rahasia: Bagikan Produk, Hasilkan Uang</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
        }
        
        html, body {
            width: 100%;
            height: 100%;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
            font-size: 14px;
            padding-top: 60px;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #2e7d32;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* å¯¼èˆªæ  */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
        }
        
        .nav-categories {
            display: flex;
            gap: 8px;
            flex: 1;
            margin: 0 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .category-item {
            padding: 8px 15px;
            border-radius: 20px;
            background-color: #f1f8e9;
            color: #2e7d32;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            border: none;
        }
        
        .category-item.active {
            background-color: #2e7d32;
            color: white;
        }
        
        .nav-user {
            display: flex;
            align-items: center;
        }
        
        .user-menu {
            position: relative;
        }
        
        .user-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #2e7d32;
        }
        
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 10px 0;
            min-width: 150px;
            display: none;
            z-index: 1001;
        }
        
        .user-dropdown.show {
            display: block;
        }
        
        .dropdown-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .dropdown-item:last-child {
            border-bottom: none;
        }
        
        /* ä¸»å®¹å™¨ */
        .container {
            max-width: 100%;
            padding: 15px;
            margin-bottom: 50px;
        }
        
        /* äº§å“åˆ—è¡¨ - æµæ°´è´¦å¸ƒå±€ */
        .products-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .product-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }
        
        .product-card:active {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }
        
        /* äº§å“ä¸»å›¾ - å®Œæ•´æ˜¾ç¤ºï¼Œä¸è£å‰ª */
        .product-image-container {
            width: 100%;
            background-color: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            overflow: hidden;
            aspect-ratio: 1;
        }
        
        .product-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background-color: #f5f5f5;
        }
        
        .product-info {
            padding: 12px;
        }
        
        .product-badge {
            display: inline-block;
            background: linear-gradient(90deg, #ff9800, #ff5722);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .product-badge.hot-sale {
            background: linear-gradient(90deg, #e53935, #ff5722);
        }
        
        .product-name {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #2e7d32;
            line-height: 1.3;
        }
        
        /* äº§å“ç»Ÿè®¡ - ä¸¤åˆ—å¸ƒå±€ */
        .product-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            font-size: 13px;
        }
        
        .stat-left {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .stat-right {
            display: flex;
            flex-direction: column;
            gap: 8px;
            text-align: right;
        }
        
        .stat-item {
            color: #666;
        }
        
        .stat-value {
            color: #e53935;
            font-weight: 600;
        }
        
        /* ä½£é‡‘ä¿¡æ¯ */
        .product-commission {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #f0f0f0;
            font-size: 13px;
            color: #666;
        }
        
        .commission-value {
            color: #2e7d32;
            font-weight: 700;
            font-size: 14px;
        }
        
        /* äº§å“è¯¦æƒ…é¡µé¢ */
        .product-detail-page {
            display: none;
            position: fixed;
            top: 60px;
            left: 0;
            width: 100%;
            height: calc(100% - 60px);
            background: white;
            overflow-y: auto;
            z-index: 500;
        }
        
        .product-detail-page.active {
            display: block;
        }
        
        .detail-media {
            width: 100%;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 250px;
        }
        
        .detail-media img,
        .detail-media video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .detail-thumbnails {
            display: flex;
            gap: 10px;
            padding: 15px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .thumbnail {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            flex-shrink: 0;
            border: 2px solid transparent;
        }
        
        .thumbnail.active {
            border-color: #2e7d32;
        }
        
        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .detail-content {
            padding: 15px;
        }
        
        .detail-name {
            font-size: 18px;
            font-weight: 700;
            color: #2e7d32;
            margin-bottom: 10px;
        }
        
        .detail-description {
            font-size: 13px;
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .detail-images {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .detail-image {
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .detail-image img {
            width: 100%;
            height: auto;
            display: block;
        }
        
        /* æµ®åŠ¨æŒ‰é’® */
        .floating-buttons {
            position: fixed;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            display: none;
            flex-direction: column;
            gap: 10px;
            z-index: 600;
        }
        
        .floating-buttons.active {
            display: flex;
        }
        
        .float-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(46, 125, 50, 0.8);
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
        }
        
        .float-btn:active {
            transform: scale(0.95);
        }
        
        .float-btn.like-btn.liked {
            background: rgba(229, 57, 53, 0.8);
        }
        
        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 20px;
            width: 90%;
            max-width: 400px;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .modal-buttons button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn-primary {
            background: #2e7d32;
            color: white;
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        
        /* ç®¡ç†å‘˜åå° */
        .admin-panel {
            display: none;
            position: fixed;
            top: 60px;
            left: 0;
            width: 100%;
            height: calc(100% - 60px);
            background: white;
            overflow-y: auto;
            z-index: 500;
        }
        
        .admin-panel.active {
            display: block;
        }
        
        .admin-content {
            padding: 15px;
        }
        
        .admin-section {
            margin-bottom: 20px;
        }
        
        .admin-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #2e7d32;
        }
        
        .admin-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        .admin-table th,
        .admin-table td {
            padding: 8px;
            border: 1px solid #f0f0f0;
            text-align: left;
        }
        
        .admin-table th {
            background: #f5f5f5;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- åŠ è½½åŠ¨ç”» -->
    <div id="loading">
        <div class="spinner"></div>
        <p>åŠ è½½ä¸­...</p>
    </div>
    
    <!-- å¯¼èˆªæ  -->
    <div class="navbar">
        <div style="font-size: 18px; font-weight: 700; color: #2e7d32;">StarVapers</div>
        <div class="nav-categories" id="navCategories"></div>
        <div class="nav-user">
            <div class="user-menu">
                <button class="user-btn" onclick="toggleUserMenu()">ğŸ‘¤</button>
                <div class="user-dropdown" id="userDropdown">
                    <div class="dropdown-item" onclick="showCommissions()">Komisi Saya</div>
                    <div class="dropdown-item" onclick="logout()">Keluar</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ä¸»é¡µé¢ -->
    <div id="homePage" class="container">
        <div class="products-list" id="productsList"></div>
    </div>
    
    <!-- äº§å“è¯¦æƒ…é¡µé¢ -->
    <div id="productDetailPage" class="product-detail-page">
        <div id="detailMainMedia" class="detail-media"></div>
        <div class="detail-thumbnails" id="detailThumbnails"></div>
        <div class="detail-content">
            <div class="detail-name" id="detailName"></div>
            <div class="detail-description" id="detailDescription"></div>
            <div class="detail-images" id="detailImages"></div>
        </div>
    </div>
    
    <!-- æµ®åŠ¨æŒ‰é’® -->
    <div class="floating-buttons" id="floatingButtons">
        <button class="float-btn like-btn" onclick="toggleLike()" title="Suka">â¤ï¸</button>
        <button class="float-btn share-btn" onclick="shareProduct()" title="Bagikan">ğŸ’°</button>
        <button class="float-btn buy-btn" onclick="buyProduct()" title="Beli">ğŸ’¬</button>
        <button class="float-btn back-btn" onclick="backToList()" title="Kembali">â†©ï¸</button>
    </div>
    
    <!-- ä½£é‡‘æ¨¡æ€æ¡† -->
    <div id="commissionModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">Verifikasi Nomor WhatsApp</div>
            <div style="font-size: 13px; color: #666; margin-bottom: 15px;">Masukkan nomor WhatsApp Anda untuk melihat komisi</div>
            <div style="display: flex; gap: 5px; margin-bottom: 10px;">
                <div style="padding: 12px; background: #f5f5f5; border-radius: 8px; font-weight: 600;">+62</div>
                <input type="text" id="whatsappInput" placeholder="8XXXXXXXXXX" style="flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
            </div>
            <div class="modal-buttons">
                <button class="btn-primary" onclick="verifyWhatsApp()">éªŒè¯ (Verifikasi)</button>
                <button class="btn-secondary" onclick="closeCommissionModal()">å–æ¶ˆ (Batal)</button>
            </div>
        </div>
    </div>
    
    <!-- ç®¡ç†å‘˜åå° -->
    <div id="adminPanel" class="admin-panel">
        <div class="admin-content">
            <div class="admin-section">
                <div class="admin-title">è®¢å•åˆ—è¡¨ (Daftar Pesanan)</div>
                <table class="admin-table" id="ordersTable">
                    <thead>
                        <tr>
                            <th>è®¢å• ID</th>
                            <th>äº§å“</th>
                            <th>åˆ†äº«è€…</th>
                            <th>ä½£é‡‘</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
    
    <script>
        // ============ é…ç½® ============
        const API_URL = 'https://tranquil-gumption-9a7e64.netlify.app/.netlify/functions/api';
        
        // ============ å…¨å±€å˜é‡ ============
        let deviceId = localStorage.getItem('deviceId') || generateDeviceId();
        let currentCategory = null;
        let currentProduct = null;
        let userPhone = localStorage.getItem('userPhone') || null;
        let allProducts = [];
        let allCategories = [];
        
        // ============ åˆå§‹åŒ– ============
        window.addEventListener('load', async () => {
            localStorage.setItem('deviceId', deviceId);
            await loadCategories();
            await loadProducts();
            document.getElementById('loading').style.display = 'none';
        });
        
        // ============ ç”Ÿæˆè®¾å¤‡ ID ============
        function generateDeviceId() {
            return 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        // ============ åŠ è½½åˆ†ç±» ============
        async function loadCategories() {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'getCategories' })
                });
                const data = await response.json();
                if (data.success) {
                    allCategories = data.data;
                    renderCategories();
                }
            } catch (error) {
                console.error('åŠ è½½åˆ†ç±»é”™è¯¯:', error);
            }
        }
        
        // ============ æ¸²æŸ“åˆ†ç±» ============
        function renderCategories() {
            const container = document.getElementById('navCategories');
            container.innerHTML = '';
            allCategories.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = 'category-item';
                btn.textContent = cat.Name;
                btn.onclick = () => filterByCategory(cat.ID);
                container.appendChild(btn);
            });
        }
        
        // ============ æŒ‰åˆ†ç±»è¿‡æ»¤ ============
        function filterByCategory(categoryId) {
            currentCategory = categoryId;
            loadProducts();
        }
        
        // ============ åŠ è½½äº§å“ ============
        async function loadProducts() {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'getProducts' })
                });
                const data = await response.json();
                if (data.success) {
                    allProducts = data.data;
                    renderProducts();
                }
            } catch (error) {
                console.error('åŠ è½½äº§å“é”™è¯¯:', error);
            }
        }
        
        // ============ æ¸²æŸ“äº§å“åˆ—è¡¨ ============
        function renderProducts() {
            const container = document.getElementById('productsList');
            container.innerHTML = '';
            
            let filtered = allProducts;
            if (currentCategory) {
                filtered = allProducts.filter(p => p.CategoryID == currentCategory);
            }
            
            filtered.forEach(product => {
                const card = createProductCard(product);
                container.appendChild(card);
            });
        }
        
        // ============ åˆ›å»ºäº§å“å¡ç‰‡ ============
        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';
            
            let mainImage = '';
            if (product.ImagesJSON) {
                try {
                    const images = JSON.parse(product.ImagesJSON);
                    if (images && images.length > 0) {
                        mainImage = `public/assets/images/products/${product.ID}/${images[0]}`;
                    }
                } catch (e) {
                    console.error('å›¾ç‰‡ JSON è§£æé”™è¯¯:', e);
                }
            }
            
            let html = '';
            if (mainImage) {
                html += `<div class="product-image-container">
                    <img src="${mainImage}" alt="${product.Name}" class="product-image">
                </div>`;
            }
            
            html += `<div class="product-info">`;
            
            if (product.IsMemberExclusive) {
                html += `<div class="product-badge">ä¼šå‘˜ä¸“å± - å…ˆåˆ°å…ˆå¾—</div>`;
            } else if (product.IsHotSale) {
                html += `<div class="product-badge hot-sale">è¶…çº§æµè¡Œ</div>`;
            }
            
            html += `<div class="product-name">${product.Name}</div>`;
            
            html += `<div class="product-stats">
                <div class="stat-left">
                    <div class="stat-item">é”€é‡: <span class="stat-value">${product.PurchasedCount || 0}</span></div>
                    <div class="stat-item">åº“å­˜: <span class="stat-value">${product.StockCount || 0}</span></div>
                </div>
                <div class="stat-right">
                    <div class="stat-item">åŸä»·: <span class="stat-value">Â¥${product.OriginalPrice || 0}</span></div>
                    <div class="stat-item">VIP: <span class="stat-value">Â¥${product.MemberPrice || 0}</span></div>
                </div>
            </div>`;
            
            if (product.IsMemberExclusive) {
                html += `<div class="product-commission">ä½£é‡‘: <span class="commission-value">0</span></div>`;
            } else if (product.Commission) {
                html += `<div class="product-commission">ä½£é‡‘: <span class="commission-value">${product.Commission}</span></div>`;
            }
            
            html += `</div>`;
            
            card.innerHTML = html;
            card.onclick = () => showProductDetail(product);
            
            return card;
        }
        
        // ============ æ˜¾ç¤ºäº§å“è¯¦æƒ… ============
        function showProductDetail(product) {
            currentProduct = product;
            document.getElementById('homePage').style.display = 'none';
            document.getElementById('productDetailPage').classList.add('active');
            document.getElementById('floatingButtons').classList.add('active');
            
            renderProductDetail(product);
            document.getElementById('productDetailPage').scrollTop = 0;
        }
        
        // ============ æ¸²æŸ“äº§å“è¯¦æƒ… ============
        function renderProductDetail(product) {
            const mainMedia = document.getElementById('detailMainMedia');
            mainMedia.innerHTML = '';
            
            if (product.VideoURL) {
                const video = document.createElement('video');
                video.src = `public/assets/videos/products/${product.VideoURL}`;
                video.controls = true;
                video.style.width = '100%';
                video.style.height = '100%';
                video.style.objectFit = 'contain';
                mainMedia.appendChild(video);
            } else if (product.ImagesJSON) {
                try {
                    const images = JSON.parse(product.ImagesJSON);
                    if (images && images.length > 0) {
                        const img = document.createElement('img');
                        img.src = `public/assets/images/products/${product.ID}/${images[0]}`;
                        img.style.width = '100%';
                        img.style.height = '100%';
                        img.style.objectFit = 'contain';
                        mainMedia.appendChild(img);
                    }
                } catch (e) {
                    console.error('å›¾ç‰‡è§£æé”™è¯¯:', e);
                }
            }
            
            // ç¼©ç•¥å›¾
            const thumbnailsContainer = document.getElementById('detailThumbnails');
            thumbnailsContainer.innerHTML = '';
            if (product.ImagesJSON) {
                try {
                    const images = JSON.parse(product.ImagesJSON);
                    images.forEach((img, index) => {
                        const thumb = document.createElement('div');
                        thumb.className = 'thumbnail' + (index === 0 ? ' active' : '');
                        thumb.innerHTML = `<img src="public/assets/images/products/${product.ID}/${img}" alt="Image ${index + 1}">`;
                        thumb.onclick = () => switchImage(product, index);
                        thumbnailsContainer.appendChild(thumb);
                    });
                } catch (e) {
                    console.error('ç¼©ç•¥å›¾è§£æé”™è¯¯:', e);
                }
            }
            
            // è¯¦æƒ…å†…å®¹
            document.getElementById('detailName').textContent = product.Name;
            document.getElementById('detailDescription').textContent = product.Description || '';
            
            // è¯¦æƒ…å›¾ç‰‡
            const imagesContainer = document.getElementById('detailImages');
            imagesContainer.innerHTML = '';
            if (product.ImagesJSON) {
                try {
                    const images = JSON.parse(product.ImagesJSON);
                    images.forEach(img => {
                        const div = document.createElement('div');
                        div.className = 'detail-image';
                        div.innerHTML = `<img src="public/assets/images/products/${product.ID}/${img}" alt="Detail Image">`;
                        imagesContainer.appendChild(div);
                    });
                } catch (e) {
                    console.error('è¯¦æƒ…å›¾ç‰‡è§£æé”™è¯¯:', e);
                }
            }
        }
        
        // ============ åˆ‡æ¢å›¾ç‰‡ ============
        function switchImage(product, index) {
            const mainMedia = document.getElementById('detailMainMedia');
            mainMedia.innerHTML = '';
            
            if (product.ImagesJSON) {
                try {
                    const images = JSON.parse(product.ImagesJSON);
                    const img = document.createElement('img');
                    img.src = `public/assets/images/products/${product.ID}/${images[index]}`;
                    img.style.width = '100%';
                    img.style.height = '100%';
                    img.style.objectFit = 'contain';
                    mainMedia.appendChild(img);
                    
                    // æ›´æ–°ç¼©ç•¥å›¾
                    document.querySelectorAll('.thumbnail').forEach((thumb, i) => {
                        thumb.classList.toggle('active', i === index);
                    });
                } catch (e) {
                    console.error('åˆ‡æ¢å›¾ç‰‡é”™è¯¯:', e);
                }
            }
        }
        
        // ============ ç‚¹èµ ============
        function toggleLike() {
            const btn = document.querySelector('.like-btn');
            btn.classList.toggle('liked');
        }
        
        // ============ åˆ†äº« ============
        function shareProduct() {
            if (!currentProduct) return;
            
            const sharerPhone = userPhone || deviceId;
            const url = `${window.location.origin}${window.location.pathname}?ref=${sharerPhone}`;
            const message = `æˆ‘å–œæ¬¢è¿™ä¸ªäº§å“ ${currentProduct.Name}ï¼Œåˆ†äº«èµšä½£é‡‘ï¼${url}`;
            
            // æ‰“å¼€ WhatsApp
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }
        
        // ============ è´­ä¹° ============
        function buyProduct() {
            if (!currentProduct) return;
            
            const message = `æˆ‘æƒ³è´­ä¹° ${currentProduct.Name}`;
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }
        
        // ============ è¿”å›åˆ—è¡¨ ============
        function backToList() {
            document.getElementById('productDetailPage').classList.remove('active');
            document.getElementById('floatingButtons').classList.remove('active');
            document.getElementById('homePage').style.display = 'block';
            currentProduct = null;
        }
        
        // ============ æ˜¾ç¤ºä½£é‡‘ ============
        function showCommissions() {
            if (userPhone) {
                loadCommissionData(userPhone);
            } else {
                document.getElementById('commissionModal').classList.add('active');
            }
        }
        
        // ============ éªŒè¯ WhatsApp ============
        async function verifyWhatsApp() {
            const input = document.getElementById('whatsappInput').value.trim();
            if (!input) {
                alert('è¯·è¾“å…¥ WhatsApp å·ç ');
                return;
            }
            
            const phone = '62' + input;
            userPhone = phone;
            localStorage.setItem('userPhone', phone);
            
            document.getElementById('commissionModal').classList.remove('active');
            loadCommissionData(phone);
        }
        
        // ============ åŠ è½½ä½£é‡‘æ•°æ® ============
        async function loadCommissionData(phone) {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'getCommissionsByPhone',
                        phone: phone
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    alert(`æ€»ä½£é‡‘: Â¥${data.data.totalCommission}\nå¾…å®¡æ ¸: Â¥${data.data.pendingCommission}\nå·²éªŒè¯: Â¥${data.data.verifiedCommission}\næ¨å¹¿å®¢æˆ·: ${data.data.referralCount}`);
                } else {
                    alert('æš‚æ— ä½£é‡‘è®°å½•');
                }
            } catch (error) {
                console.error('åŠ è½½ä½£é‡‘æ•°æ®é”™è¯¯:', error);
                alert('åŠ è½½å¤±è´¥');
            }
        }
        
        // ============ å…³é—­ä½£é‡‘æ¨¡æ€æ¡† ============
        function closeCommissionModal() {
            document.getElementById('commissionModal').classList.remove('active');
        }
        
        // ============ åˆ‡æ¢ç”¨æˆ·èœå• ============
        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }
        
        // ============ ç™»å‡º ============
        function logout() {
            userPhone = null;
            localStorage.removeItem('userPhone');
            document.getElementById('userDropdown').classList.remove('show');
        }
    </script>
</body>
</html>
